import{r as e,a,R as r}from"./react-da68e5f0.js";import{d as t,g as s,s as o,c as i,a as l,q as n,w as d,b as c,e as m,o as u,i as x,f as g,h,j as f,k as p,l as b,m as y}from"./firebase-7508e62b.js";import{r as j,u as v}from"./xlsx-2f7b8edf.js";import{n as w,c as N,e as k,p as E}from"./utils-d3c5c3a6.js";import{C as S,a as L,L as C,B as A,p as P,b as D,c as O,d as T,R as M,e as I,f as B,X as R,Y as $,T as F,g as z,h as _}from"./charts-4c2e39fc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)}).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();var U={exports:{}},H={},W=e,J=Symbol.for("react.element"),V=Symbol.for("react.fragment"),Z=Object.prototype.hasOwnProperty,K=W.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q={key:!0,ref:!0,__self:!0,__source:!0};function Y(e,a,r){var t,s={},o=null,i=null;for(t in void 0!==r&&(o=""+r),void 0!==a.key&&(o=""+a.key),void 0!==a.ref&&(i=a.ref),a)Z.call(a,t)&&!q.hasOwnProperty(t)&&(s[t]=a[t]);if(e&&e.defaultProps)for(t in a=e.defaultProps)void 0===s[t]&&(s[t]=a[t]);return{$$typeof:J,type:e,key:o,ref:i,props:s,_owner:K.current}}H.Fragment=V,H.jsx=Y,H.jsxs=Y,U.exports=H;var G=U.exports,X={},Q=a;function ee({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15M9 12l3 3m0 0 3-3m-3 3V2.25"}))}X.createRoot=Q.createRoot,X.hydrateRoot=Q.hydrateRoot;const ae=e.forwardRef(ee);function re({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const te=e.forwardRef(re);function se({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15"}))}const oe=e.forwardRef(se);function ie({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const le=e.forwardRef(ie);function ne({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const de=e.forwardRef(ne);function ce({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const me=e.forwardRef(ce);function ue({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const xe=e.forwardRef(ue);function ge({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const he=e.forwardRef(ge);function fe({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"}))}const pe=e.forwardRef(fe);function be({title:a,titleId:r,...t},s){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},t),a?e.createElement("title",{id:r},a):null,e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const ye=e.forwardRef(be),je=(e,a,r)=>{if(!(null==r?void 0:r.asignaciones))return"No identificada";const t=null==e?void 0:e.toString().trim(),s=w(a);if(!t&&!s)return"No identificada";for(const[o,i]of Object.entries(r.asignaciones)){if(!Array.isArray(i))continue;if(i.some(e=>{if(!e)return!1;const a=w(e.beneficiario),r=s&&a===s,o=t&&e.telefonos&&Array.isArray(e.telefonos)&&e.telefonos.some(e=>(null==e?void 0:e.toString().trim())===t);return r||o}))return o}return"No identificada"};class ve extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){console.error("Error in component:",e,a)}render(){return this.state.hasError?G.jsxs("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[G.jsx("strong",{className:"font-bold",children:"Ha ocurrido un error: "}),G.jsx("span",{className:"block sm:inline",children:this.state.error.message}),G.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"mt-2 bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200",children:"Reintentar"})]}):this.props.children}}const we=r.memo(function({title:e,value:a,icon:r,subtitle:t=null,percentage:s=null}){return G.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[G.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r&&G.jsx("div",{className:"flex-shrink-0",children:r}),G.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e})]}),G.jsxs("div",{className:"flex items-baseline",children:["                ",G.jsxs("div",{children:[G.jsx("p",{className:"text-3xl font-bold text-gray-700 dark:text-gray-200",children:"number"==typeof a?a.toLocaleString():a||0}),t&&G.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t}),null!==s&&G.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",s,"%)"]})]})]})]})});S.register(L,C,A,P,D,O);const Ne={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}},ke=({data:e})=>{var a;return(null==(a=null==e?void 0:e.labels)?void 0:a.length)?G.jsx("div",{className:"h-full w-full",children:G.jsx(T,{options:Ne,data:e})}):null},Ee=({stats:e,operatorStats:a})=>{const t=Object.entries(e.comunas||{}).map(([e,a])=>({comuna:e,cantidad:Array.isArray(a)?a.length:0})).sort((e,a)=>a.cantidad-e.cantidad),s=Object.entries(a||{}).map(([e,a])=>({operadora:e,totalLlamadas:a.totalLlamadas||0,beneficiarios:a.beneficiarios||0,promedioLlamadas:((a.totalLlamadas||0)/30).toFixed(1),duracionPromedio:a.duracionTotal&&a.totalLlamadas?Math.round(a.duracionTotal/a.totalLlamadas):0})).sort((e,a)=>a.totalLlamadas-e.totalLlamadas);return G.jsxs("div",{className:"space-y-8",children:[s.length>0&&G.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[G.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Métricas por Teleoperadora"}),G.jsx("div",{className:"overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[G.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:G.jsxs("tr",{children:[G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Teleoperadora"}),G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Llamadas"}),G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Beneficiarios"}),G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Promedio Diario"}),G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Duración Promedio"})]})}),G.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:s.map(({operadora:e,totalLlamadas:a,beneficiarios:t,promedioLlamadas:s,duracionPromedio:o})=>G.jsxs(r.Fragment,{children:[G.jsxs("tr",{children:[G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:a}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:Array.isArray(t)?t.length:t}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:s}),G.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[o," min"]})]}),Array.isArray(t)&&t.length>0&&G.jsx("tr",{children:G.jsx("td",{colSpan:"5",className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:G.jsx("ul",{className:"list-disc pl-8",children:t.map((a,r)=>G.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:a},`${e}-${r}`))})})})]},e))})]})})]}),G.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[G.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Distribución Horaria de Llamadas"}),G.jsx("div",{className:"h-[400px]",children:G.jsx(ke,{data:{labels:["8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00"],datasets:[{label:"Cantidad de Llamadas",data:[10,15,20,25,30,25,20,15,10,5],backgroundColor:"rgba(53, 162, 235, 0.5)"}]}})})]}),t.length>0&&G.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[G.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Distribución por Comuna"}),G.jsx("div",{className:"overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[G.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:G.jsxs("tr",{children:[G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Comuna"}),G.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Beneficiarios"})]})}),G.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.map(({comuna:e,cantidad:a})=>G.jsxs("tr",{children:[G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:a})]},e))})]})})]})]})},Se=({progress:e})=>G.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:G.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl flex flex-col items-center w-80 max-w-[90vw]",children:[G.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 dark:border-blue-400 mb-4"}),G.jsx("p",{className:"text-lg mb-4 text-gray-900 dark:text-white",children:"Procesando archivo..."}),e>0&&G.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:G.jsx("div",{className:"bg-blue-600 dark:bg-blue-500 h-2.5 rounded-full transition-all duration-300",style:{width:`${e}%`}})})]})});function Le(){const{callData:a,assignments:r,updateCallData:i}=e.useContext(Ve),[l,n]=e.useState(null),[d,c]=e.useState(!1),[m,u]=e.useState(0),[x,g]=e.useState(null),[h,f]=e.useState(N());e.useState(!1),e.useState(null);const p=e.useRef(null),b=e.useRef(null),y=e.useRef(null),S=e.useRef(null),L=e.useRef(N()),C=e.useRef(null);e.useEffect(()=>()=>{y.current&&clearTimeout(y.current),S.current&&clearTimeout(S.current),b.current&&clearTimeout(b.current)},[]),e.useEffect(()=>{(async()=>{if(!a)try{const e=t(We,"callData","stats"),a=await s(e);if(a.exists()){const e=E(a.data());f(e)}else console.log("No data found in Firestore, initializing stats."),f(L.current)}catch(e){console.error("Error loading data from Firestore:",e),f(L.current)}})()},[a]);const A=e.useCallback(async()=>{if(l)try{c(!0),u(0),g(null),f(L.current);const e=new FileReader;e.onload=async e=>{var a;try{if(!(null==(a=e.target)?void 0:a.result))throw new Error("Error al leer el archivo");const t=new Uint8Array(e.target.result),s=j(t,{type:"array"});if(!s.SheetNames.length)throw new Error("El archivo Excel no contiene hojas");const o=s.Sheets[s.SheetNames[0]];if(!o)throw new Error("No se pudo leer la hoja de Excel");const i=v.sheet_to_json(o,{header:1});if(i.length<=1)throw new Error("El archivo no contiene datos");const l=i.slice(1),n=l.length;let d=N();const m=async e=>{const a=Math.min(e+1e3,n);l.slice(e,a).forEach(e=>{var a;if(Array.isArray(e)&&!(e.length<10))try{const[t,s,o,i,l,n,c,m,u,x,g,h]=e;if(!o||!s)return;const f=w(o),p=k(s),b=je(n,f,r),y=null==x?void 0:x.toString().toLowerCase().includes("exitoso"),j=Math.round(parseInt(u||0)/60),v={fecha:p,hora:c,duracion:j,tipo:(null==l?void 0:l.toString().toLowerCase())||"",telefono:(null==n?void 0:n.toString())||"",teleoperadora:b,comentarios:(null==g?void 0:g.toString())||"",resultado:(null==x?void 0:x.toString())||"",comuna:(null==i?void 0:i.toString())||"",exitoso:y};if(d.totalLlamadas++,d.entrantes+=(null==l?void 0:l.toString().toLowerCase().includes("entrante"))?1:0,d.salientes+=(null==l?void 0:l.toString().toLowerCase().includes("saliente"))?1:0,d.duracionTotal+=j,d.duracionPromedio=d.duracionTotal/d.totalLlamadas,f&&isNaN(f)){d.beneficiarios.add(f),d.llamadasPorBeneficiario[f]||(d.llamadasPorBeneficiario[f]=[]),d.llamadasPorBeneficiario[f].push(v),(!(null==(a=d.ultimasLlamadas[f])?void 0:a.fecha)||p>d.ultimasLlamadas[f].fecha)&&(d.ultimasLlamadas[f]=v),i&&(d.comunas.has(i)||d.comunas.set(i,new Set),d.comunas.get(i).add(f));const e=d.ultimasLlamadas[f],r=Math.floor((new Date-e.fecha)/864e5);y&&r<=15?d.beneficiariosAlDia.add(f):!y&&r>15?d.beneficiariosPendientes.add(f):!y&&r>30&&d.beneficiariosUrgentes.add(f),d.teleoperadoras[b]||(d.teleoperadoras[b]={total:0,exitosas:0,beneficiarios:new Set}),d.teleoperadoras[b].total++,d.teleoperadoras[b].beneficiarios.add(f),y&&d.teleoperadoras[b].exitosas++}}catch(t){console.error("Error processing row:",t)}});const t=Math.round(a/n*100);u(t),f(d),a<n?S.current=setTimeout(()=>m(a),0):(c(!1),u(100))};await m(0)}catch(t){console.error("Error processing Excel:",t),g(`Error al procesar el archivo: ${t.message}`),f(L.current),c(!1)}},e.onerror=()=>{g("Error al leer el archivo"),f(L.current),c(!1)},e.readAsArrayBuffer(l)}catch(e){console.error("Error processing file:",e),g(`Error al procesar el archivo: ${e.message}`),f(L.current),c(!1)}else g("Por favor selecciona un archivo")},[l,r]),P=e.useCallback(e=>{var a;const r=null==(a=e.target.files)?void 0:a[0];if(r){if(!r.name.match(/\.(xlsx|xls)$/i))return g("Por favor selecciona un archivo Excel válido (.xlsx o .xls)"),void(p.current&&(p.current.value=""));n(r),g(null)}else g("Por favor selecciona un archivo")},[]);e.useEffect(()=>{if(!h||0===h.totalLlamadas)return;if(C.current&&JSON.stringify(C.current)===JSON.stringify(h))return;C.current=h;(async()=>{try{const e=t(We,"callData","stats");await o(e,((e,a)=>{if(!e)return null;try{return{totalLlamadas:e.totalLlamadas||0,entrantes:e.entrantes||0,salientes:e.salientes||0,duracionTotal:e.duracionTotal||0,duracionPromedio:e.duracionPromedio||0,beneficiarios:Array.from(e.beneficiarios||[]),beneficiariosAlDia:Array.from(e.beneficiariosAlDia||[]),beneficiariosPendientes:Array.from(e.beneficiariosPendientes||[]),beneficiariosUrgentes:Array.from(e.beneficiariosUrgentes||[]),comunas:Object.fromEntries(Array.from(e.comunas||[]).map(([e,a])=>[e,Array.from(a||[])])),llamadasPorBeneficiario:Object.entries(e.llamadasPorBeneficiario||{}).reduce((r,[t,s])=>{var o,i;return r[t]={total:Array.isArray(s)?s.length:0,operadora:je(null,t,a),estado:(null==(o=e.beneficiariosAlDia)?void 0:o.has(t))?"al-dia":(null==(i=e.beneficiariosUrgentes)?void 0:i.has(t))?"urgente":"pendiente",llamadas:Array.isArray(s)?s.map(e=>({...e,fecha:e.fecha instanceof Date&&!isNaN(e.fecha)?e.fecha.toISOString():"string"==typeof e.fecha?e.fecha:null})):[]},r},{}),ultimasLlamadas:Object.entries(e.ultimasLlamadas||{}).reduce((e,[a,r])=>(r&&(e[a]={...r,fecha:r.fecha instanceof Date&&!isNaN(r.fecha)?r.fecha.toISOString():"string"==typeof r.fecha?r.fecha:null}),e),{}),llamadasExitosas:Object.entries(e.llamadasExitosas||{}).reduce((e,[a,r])=>(Array.isArray(r)&&(e[a]=r.map(e=>({...e,fecha:e.fecha instanceof Date&&!isNaN(e.fecha)?e.fecha.toISOString():"string"==typeof e.fecha?e.fecha:null}))),e),{}),teleoperadoras:Object.entries(e.teleoperadoras||{}).reduce((e,[a,r])=>(e[a]={total:r.total||0,exitosas:r.exitosas||0,beneficiarios:Array.from(r.beneficiarios||[])},e),{})}}catch(x){return console.error("Error preparing stats for storage:",x),null}})(h)),console.log("Data successfully saved to Firestore.")}catch(e){console.error("Error saving data to Firestore:",e)}})();const e={};h.beneficiarios.forEach(a=>{var t,s;const o=je(null,a,r);o&&(e[o]||(e[o]={totalLlamadas:0,beneficiarios:[],duracionTotal:0}),e[o].totalLlamadas+=(null==(t=h.llamadasPorBeneficiario[a])?void 0:t.length)||0,e[o].duracionTotal+=(null==(s=h.llamadasPorBeneficiario[a])?void 0:s.reduce((e,a)=>e+a.duracion,0))||0,e[o].beneficiarios.includes(a)||e[o].beneficiarios.push(a))}),i({...a,stats:h,operatorStats:e})},[h,i,r]);const D=e.useCallback(()=>{n(null),f(L.current),u(0),g(null),c(!1),p.current&&(p.current.value="");(async()=>{try{const e=t(We,"callData","stats");await o(e,{}),console.log("Data successfully cleared from Firestore.")}catch(e){console.error("Error clearing data from Firestore:",e)}})(),i(L.current)},[]);return G.jsx(ve,{children:G.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:["                ",G.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-6 space-y-4 lg:space-y-0",children:[G.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[G.jsx(xe,{className:"h-8 w-8 mr-2 text-blue-500 dark:text-blue-400"}),"Registro de Llamadas"]}),G.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[G.jsxs("button",{onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()},className:`inline-flex items-center px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200\n                                ${d?"opacity-50 cursor-not-allowed":"hover:bg-blue-600 dark:hover:bg-blue-700"} \n                                bg-blue-500 dark:bg-blue-600 text-white focus:ring-blue-500`,disabled:d,children:[G.jsx(oe,{className:"h-5 w-5 mr-2"}),l?l.name:"Seleccionar Archivo"]}),G.jsxs("button",{onClick:A,disabled:!l||d,className:"inline-flex items-center px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200\n                                "+(l&&!d?"bg-green-500 dark:bg-green-600 text-white hover:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"),title:l?d?"Procesando...":"Procesar archivo":"Seleccione un archivo primero",children:[G.jsx(ae,{className:"h-5 w-5 mr-2"}),d?"Procesando...":"Procesar Archivo"]}),h.totalLlamadas>0&&G.jsxs("button",{onClick:D,className:"inline-flex items-center px-4 py-2 bg-red-500 dark:bg-red-600 text-white rounded-lg hover:bg-red-600 dark:hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200",title:"Limpiar datos y cargar nuevo archivo",children:[G.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Limpiar"]})]}),G.jsx("input",{type:"file",ref:p,onChange:P,accept:".xlsx,.xls",className:"hidden"})]}),x&&G.jsxs("div",{className:"mb-6 p-4 bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-200",children:[G.jsxs("div",{className:"flex items-center",children:[G.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:G.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),G.jsx("p",{className:"font-medium",children:x})]}),G.jsx("button",{onClick:D,className:"mt-2 text-sm text-red-600 dark:text-red-300 hover:text-red-800 dark:hover:text-red-100",children:"Intentar de nuevo"})]}),d&&G.jsx(Se,{progress:m}),G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[G.jsx(we,{icon:G.jsx(pe,{className:"h-8 w-8 text-blue-500"}),title:"Total de Llamadas",value:h.totalLlamadas,subtitle:`${h.entrantes} entrantes, ${h.salientes} salientes`}),G.jsx(we,{icon:G.jsx(le,{className:"h-8 w-8 text-green-500"}),title:"Beneficiarios Únicos",value:h.beneficiarios.size,subtitle:"Total de personas contactadas"}),G.jsx(we,{icon:G.jsx(me,{className:"h-8 w-8 text-purple-500"}),title:"Duración Promedio",value:`${Math.round(h.duracionPromedio)} min`,subtitle:`Total: ${Math.round(h.duracionTotal)} min`})]}),"                ",h.totalLlamadas>0&&G.jsx(Ee,{stats:{...h,comunas:h.comunas||new Map,horasPico:new Map,totalLlamadas:h.totalLlamadas||0},operatorStats:Object.entries(h.llamadasPorBeneficiario||{}).reduce((e,[a,r])=>{const t=r.operadora||"No asignada";return e[t]||(e[t]={totalLlamadas:0,beneficiarios:new Set,diasTrabajados:30,duracionTotal:0}),e[t].totalLlamadas+=r.total||0,e[t].beneficiarios.add(a),e[t].duracionTotal+=(r.total||0)*h.duracionPromedio,e},{})})]})})}const Ce=()=>{const{darkMode:a,toggleTheme:r}=e.useContext(Ge);return G.jsxs("div",{className:"flex items-center justify-between w-full px-4",children:[G.jsx("div",{className:"flex items-center",children:G.jsx("img",{src:"https://www.mistatas.cl/assets/img/logo-small.png",alt:"Mistatas Logo",className:"h-12 w-auto mr-2"})}),G.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":"Toggle dark mode",children:a?G.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):G.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]})},Ae=e.memo(({message:a,type:r,onDismiss:t})=>(e.useEffect(()=>{if(a){const e=setTimeout(t,3e3);return()=>clearTimeout(e)}},[a,t]),a?G.jsx("div",{className:"fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg "+("success"===r?"bg-green-500":"bg-red-500"),children:a}):null)),Pe=({progress:e,stats:a})=>G.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50",children:G.jsx("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:G.jsxs("div",{className:"flex flex-col items-center",children:[G.jsx(te,{className:"w-12 h-12 animate-spin text-blue-500 mb-4"}),G.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Procesando archivo..."}),G.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-2",children:G.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:e.processed/e.total*100+"%"}})}),G.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Procesando ",e.processed," de ",e.total," registros"]}),a&&G.jsxs("div",{className:"text-sm space-y-1 text-gray-600 text-center border-t border-gray-200 pt-3 mt-2 w-full",children:[G.jsxs("p",{children:["✅ ",a.beneficiariosCreados," nuevos beneficiarios"]}),G.jsxs("p",{children:["🔄 ",a.duplicadosEncontrados," beneficiarios existentes"]}),G.jsxs("p",{children:["📋 ",a.asignacionesCreadas," asignaciones creadas"]}),a.errores>0&&G.jsxs("p",{className:"text-red-500",children:["❌ ",a.errores," errores encontrados"]})]})]})})}),De=e.memo(({asignacion:e,beneficiario:a,onDelete:r})=>a?G.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-white border border-gray-100 rounded-lg hover:border-gray-200 transition-colors",children:[G.jsxs("div",{className:"flex flex-col",children:[G.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.nombre}),a.telefono&&G.jsxs("span",{className:"text-xs text-gray-500 mt-1",children:["📞 ",a.telefono]})]}),G.jsx("button",{onClick:t=>{t.stopPropagation(),r(e.id,a.nombre)},className:"text-red-600 hover:text-red-800 p-2 hover:bg-red-50 rounded-full transition-colors",title:"Eliminar asignación",children:G.jsx(ye,{className:"h-5 w-5"})})]}):null),Oe=()=>{e.useContext(Ve);const[a,r]=e.useState(!0),[s,x]=e.useState([]),[g,h]=e.useState([]),[f,p]=e.useState([]),[b,y]=e.useState(""),[w,N]=e.useState(""),[k,E]=e.useState(null),[S,L]=e.useState(null),[C,A]=e.useState({message:"",type:""}),[P,D]=e.useState(!1),[O,T]=e.useState({total:0,processed:0}),[M,I]=e.useState({beneficiariosCreados:0,duplicadosEncontrados:0,asignacionesCreadas:0,errores:0}),B=e.useRef({operadoras:!1,beneficiarios:!1,asignaciones:!1}),R=e.useCallback(()=>{const e=B.current;e.operadoras&&e.beneficiarios&&e.asignaciones&&r(!1)},[]),$=e.useCallback(async()=>{if(b&&w)try{const e=s.find(e=>e.id===b),a=g.find(e=>e.id===w);if(!e||!a)return void A({message:"Error: Operadora o beneficiario no encontrado",type:"error"});const r={operadoraId:b,beneficiarioId:w,createdAt:(new Date).toISOString()},l=t(i(We,"asignaciones"));await o(l,r),y(""),N(""),A({message:"Asignación creada con éxito",type:"success"})}catch(e){console.error("Error creating assignment:",e),A({message:"Error al crear la asignación",type:"error"})}},[b,w,s,g]),F=e.useCallback(async(e,a)=>{try{await l(t(We,"asignaciones",e)),A({message:`Asignación de ${a} eliminada con éxito`,type:"success"})}catch(r){console.error("Error deleting assignment:",r),A({message:"Error al eliminar la asignación",type:"error"})}},[]),z=async(e,a)=>{const r=i(We,"beneficiarios"),t=n(r,d("nombre","==",e.trim())),s=a?n(r,d("telefono","==",a.trim())):null,[o,l]=await Promise.all([c(t),s?c(s):Promise.resolve({empty:!0})]);if(!o.empty){const e=o.docs[0];return{existe:!0,id:e.id,data:e.data()}}if(s&&!l.empty){const e=l.docs[0];return{existe:!0,id:e.id,data:e.data()}}return{existe:!1}},_=e.useCallback(async()=>{if(S&&b)try{D(!0);const a=await S.arrayBuffer(),r=j(a),s=r.Sheets[r.SheetNames[0]],l=v.sheet_to_json(s,{header:["nombre","telefono"]}).slice(1);T({total:l.length,processed:0});const u=i(We,"asignaciones"),x=n(u,d("operadoraId","==",b)),g=await c(x),h=m(We);g.docs.forEach(e=>{h.delete(e.ref)}),await h.commit(),I({beneficiariosCreados:0,duplicadosEncontrados:0,asignacionesCreadas:0,errores:0});for(const[n,d]of l.entries())if(d.nombre)try{T(e=>({...e,processed:n+1}));const e=d.telefono?d.telefono.toString().split(",").map(e=>e.trim()).filter(e=>e):[],a=await z(d.nombre,e[0]);let r;if(a.existe)I(e=>({...e,duplicadosEncontrados:e.duplicadosEncontrados+1})),r=a.id;else{const a=t(i(We,"beneficiarios"));await o(a,{nombre:d.nombre.trim(),telefono:e[0]||"",telefonos:e,createdAt:(new Date).toISOString()}),I(e=>({...e,beneficiariosCreados:e.beneficiariosCreados+1})),r=a.id}const s=t(i(We,"asignaciones"));await o(s,{operadoraId:b,beneficiarioId:r,createdAt:(new Date).toISOString()}),I(e=>({...e,asignacionesCreadas:e.asignacionesCreadas+1}))}catch(e){console.error(`Error procesando fila ${d.nombre}:`,e),I(e=>({...e,errores:e.errores+1}))}L(null),y("");const f=M;let p=`Proceso completado: ${f.beneficiariosCreados} beneficiarios nuevos, ${f.duplicadosEncontrados} existentes, ${f.asignacionesCreadas} asignaciones creadas`;f.errores>0&&(p+=`, ${f.errores} errores encontrados`),A({message:p,type:f.errores>0?"error":"success"})}catch(e){console.error("Error procesando archivo:",e),A({message:"Error procesando archivo",type:"error"})}finally{D(!1),T({total:0,processed:0}),I({beneficiariosCreados:0,duplicadosEncontrados:0,asignacionesCreadas:0,errores:0})}},[S,b]);return e.useEffect(()=>{let e=!0;const a=[];return(async()=>{try{const r=n(i(We,"users")),t=u(r,a=>{if(!e)return;const r=a.docs.map(e=>({id:e.id,...e.data()})).filter(e=>"teleoperadora"===e.rol);x(r),B.current.operadoras=!0,R()});a.push(t);const s=n(i(We,"beneficiarios")),o=u(s,a=>{if(!e)return;const r=a.docs.map(e=>({id:e.id,...e.data()}));h(r),B.current.beneficiarios=!0,R()});a.push(o);const l=n(i(We,"asignaciones")),d=u(l,a=>{if(!e)return;const r=a.docs.map(e=>({id:e.id,...e.data()}));p(r),B.current.asignaciones=!0,R()});a.push(d)}catch(t){console.error("Error setting up subscriptions:",t),e&&(A({message:"Error cargando datos",type:"error"}),r(!1))}})(),()=>{e=!1,a.forEach(e=>e())}},[R]),a?G.jsx("div",{className:"flex flex-col items-center justify-center p-8",children:G.jsxs("div",{className:"flex items-center mb-4",children:[G.jsx(te,{className:"w-8 h-8 animate-spin text-blue-500"}),G.jsx("span",{className:"ml-2",children:"Cargando datos..."})]})}):G.jsxs("div",{className:"space-y-6",children:["            ",G.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[G.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Carga Masiva de Asignaciones"}),G.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:[G.jsxs("div",{className:"mb-6",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar Teleoperadora"}),G.jsxs("select",{value:b,onChange:e=>y(e.target.value),className:"w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[G.jsx("option",{value:"",children:"Seleccionar operadora para asignación masiva"}),s.map(e=>G.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),G.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[G.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Formato del Excel:"}),G.jsxs("div",{className:"space-y-2",children:[G.jsx("p",{className:"text-xs text-gray-600",children:"• Columna A: Nombre del beneficiario"}),G.jsx("p",{className:"text-xs text-gray-600",children:"• Columna B: Teléfonos (separados por comas)"}),G.jsx("p",{className:"text-xs text-gray-500 italic",children:"Nota: Los beneficiarios serán asignados a la teleoperadora seleccionada"})]})]}),G.jsx("input",{type:"file",onChange:e=>L(e.target.files[0]),accept:".xlsx,.xls",className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),G.jsxs("button",{onClick:_,disabled:!S||!b,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[G.jsx(oe,{className:"h-5 w-5 mr-2"}),"Subir y Procesar Asignaciones"]})]})]}),G.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[G.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Asignación Manual"}),G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[G.jsxs("div",{children:[G.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Operadora"}),G.jsxs("select",{value:b,onChange:e=>y(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[G.jsx("option",{value:"",children:"Seleccionar operadora"}),s.map(e=>G.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),G.jsxs("div",{children:[G.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Beneficiario"}),G.jsxs("select",{value:w,onChange:e=>N(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[G.jsx("option",{value:"",children:"Seleccionar beneficiario"}),g.map(e=>G.jsx("option",{value:e.id,children:e.nombre},e.id))]})]})]}),G.jsx("button",{onClick:$,disabled:!b||!w,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Crear Asignación"})]}),G.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[G.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:G.jsx("h3",{className:"text-lg font-semibold",children:"Asignaciones Actuales"})}),G.jsx("div",{className:"divide-y divide-gray-200",children:s.map(e=>{const a=f.filter(a=>a.operadoraId===e.id);return G.jsxs("div",{className:"p-6 border-b border-gray-200 last:border-b-0",children:[G.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors",onClick:()=>E(k===e.id?null:e.id),children:[G.jsxs("div",{className:"flex items-center space-x-3",children:[G.jsx("h4",{className:"text-lg font-medium text-gray-900",children:e.nombre}),G.jsxs("div",{className:"px-3 py-1 text-sm font-medium rounded-full "+(a.length>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:[a.length," beneficiarios"]})]}),G.jsx(de,{className:"h-5 w-5 text-gray-500 transform transition-transform duration-200 "+(k===e.id?"rotate-180":"")})]}),k===e.id&&G.jsx("div",{className:"mt-4 space-y-2 pl-4",children:0===a.length?G.jsx("p",{className:"text-sm text-gray-500 italic py-4",children:"No hay beneficiarios asignados a esta operadora"}):G.jsx("div",{className:"space-y-2",children:a.map(e=>{const a=g.find(a=>a.id===e.beneficiarioId);return G.jsx(De,{asignacion:e,beneficiario:a,onDelete:F},e.id)})})})]},e.id)})})]}),G.jsx(Ae,{message:C.message,type:C.type,onDismiss:()=>A({message:"",type:""})}),P&&G.jsx(Pe,{progress:O,stats:M})]})},Te=({title:e,value:a,subtitle:r,icon:t})=>G.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-colors duration-200",children:G.jsxs("div",{className:"flex items-center",children:[t&&G.jsx(t,{className:"h-8 w-8 text-blue-500 dark:text-blue-400 mr-3"}),G.jsxs("div",{children:[G.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e}),G.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a}),r&&G.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r})]})]})}),Me=()=>{var a,r,t,s,o;const{callData:l,assignments:d}=e.useContext(Ve),[m,u]=e.useState({totalLlamados:0,tiempoTotal:0,beneficiariosAtendidos:new Set,rendimientoPorOperadora:{}}),[x,g]=e.useState({fechaInicio:"",fechaFin:"",operadora:"Todas las operadoras",comuna:"Todas las comunas",tipo:"Todos los tipos"});e.useEffect(()=>{(async()=>{try{const e=n(i(We,"llamadas")),a=await c(e),r=n(i(We,"seguimientos")),t=await c(r),s={totalLlamados:0,tiempoTotal:0,beneficiariosAtendidos:new Set,rendimientoPorOperadora:{}};a.forEach(e=>{const a=e.data();s.totalLlamados++,s.tiempoTotal+=a.duracion||0,s.beneficiariosAtendidos.add(a.beneficiario),a.operadora&&(s.rendimientoPorOperadora[a.operadora]||(s.rendimientoPorOperadora[a.operadora]={llamados:0,minutos:0}),s.rendimientoPorOperadora[a.operadora].llamados++,s.rendimientoPorOperadora[a.operadora].minutos+=a.duracion||0)}),t.forEach(e=>{const a=e.data();s.totalLlamados++,s.beneficiariosAtendidos.add(a.beneficiario),a.operadora&&(s.rendimientoPorOperadora[a.operadora]||(s.rendimientoPorOperadora[a.operadora]={llamados:0,minutos:0}),s.rendimientoPorOperadora[a.operadora].llamados++)}),u(s)}catch(e){console.error("Error al cargar datos:",e)}})()},[]);const h=(null==(a=null==d?void 0:d.beneficiarios)?void 0:a.length)||0,f=m.totalLlamados>0?Math.round(m.tiempoTotal/m.totalLlamados*10)/10:0;null==(r=null==d?void 0:d.operadoras)||r.forEach(e=>{y.find(a=>a.name===e.nombre)||y.push({name:e.nombre,llamados:0,minutos:0,tiempoPromedio:0})});const p=(null==(t=l.beneficiariosAtendidos)?void 0:t.size)||0,b=h>0?Math.round(p/h*100):0,y=Object.entries(m.rendimientoPorOperadora).map(([e,a])=>({name:e,llamados:a.llamados,minutos:a.minutos,tiempoPromedio:a.llamados>0?Math.round(a.minutos/a.llamados*10)/10:0,porcentajeTotal:Math.round(a.llamados/m.totalLlamados*100)||0}));return G.jsxs("div",{className:"space-y-6 p-6 dark:bg-gray-900",children:[G.jsxs("div",{className:"flex items-center justify-between mb-8",children:[G.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard de Análisis"}),G.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Última actualización: ",(new Date).toLocaleString()]})]}),"            ",G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[G.jsx(Te,{title:"Total de Llamados",value:m.totalLlamados,subtitle:"Llamadas registradas"}),G.jsx(Te,{title:"Tiempo Total (min)",value:Math.round(m.tiempoTotal),subtitle:`Promedio: ${f} min/llamada`}),G.jsx(Te,{title:"Cobertura",value:`${Math.round(m.beneficiariosAtendidos.size/h*100)}%`,subtitle:`${m.beneficiariosAtendidos.size} de ${h} beneficiarios`}),G.jsx(Te,{title:"Operadoras Activas",value:Object.keys(m.rendimientoPorOperadora).length,subtitle:"Teleoperadoras en servicio"})]}),G.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md space-y-4",children:[G.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4",children:"Filtros"}),G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[G.jsxs("div",{className:"space-y-2",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Fecha Inicio"}),G.jsx("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x.fechaInicio,onChange:e=>g({...x,fechaInicio:e.target.value})})]}),G.jsxs("div",{className:"space-y-2",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Fecha Fin"}),G.jsx("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x.fechaFin,onChange:e=>g({...x,fechaFin:e.target.value})})]}),G.jsxs("div",{className:"space-y-2",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Operadora"}),G.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x.operadora,onChange:e=>g({...x,operadora:e.target.value}),children:[G.jsx("option",{children:"Todas las operadoras"}),null==(s=null==d?void 0:d.operadoras)?void 0:s.map(e=>G.jsx("option",{children:e.nombre},e.id))]})]}),G.jsxs("div",{className:"space-y-2",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Comuna"}),G.jsx("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x.comuna,onChange:e=>g({...x,comuna:e.target.value}),children:G.jsx("option",{children:"Todas las comunas"})})]}),G.jsxs("div",{className:"space-y-2",children:[G.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Tipo"}),G.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x.tipo,onChange:e=>g({...x,tipo:e.target.value}),children:[G.jsx("option",{children:"Todos los tipos"}),G.jsx("option",{children:"Entrante"}),G.jsx("option",{children:"Saliente"})]})]})]})]}),G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[G.jsx(Te,{title:"Total Llamados",value:l.totalLlamados||0,subtitle:"Llamadas registradas"}),G.jsx(Te,{title:"Tiempo Total",value:`${l.tiempoTotal||0} min`,subtitle:`${f} min/llamada`}),G.jsx(Te,{title:"Cobertura",value:`${b}%`,subtitle:`${p} de ${h} beneficiarios`}),G.jsx(Te,{title:"Operadoras Activas",value:(null==(o=null==d?void 0:d.operadoras)?void 0:o.length)||0,subtitle:"Teleoperadoras registradas"})]}),G.jsxs("div",{className:"mt-8",children:[G.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4",children:"Rendimiento por Teleoperadora"}),G.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:G.jsx(M,{width:"100%",height:400,children:G.jsxs(I,{data:y,children:[G.jsx(B,{strokeDasharray:"3 3",stroke:"#374151"}),G.jsx(R,{dataKey:"name",stroke:"#374151"}),G.jsx($,{stroke:"#374151"}),G.jsx(F,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"0.5rem",color:"#f3f4f6"}}),G.jsx(z,{}),G.jsx(_,{dataKey:"llamados",fill:"#3b82f6",name:"Llamados"}),G.jsx(_,{dataKey:"minutos",fill:"#10b981",name:"Minutos"})]})})})]}),G.jsxs("div",{className:"mt-8",children:[G.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4",children:"Detalle por Teleoperadora"}),G.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden",children:G.jsx("div",{className:"overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[G.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:G.jsxs("tr",{children:[G.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Operadora"}),G.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Llamados"}),G.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Minutos Totales"}),G.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Tiempo Promedio"}),G.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"% del Total"})]})}),G.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:y.map((e,a)=>G.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:e.name}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:e.llamados}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:e.minutos}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:e.tiempoPromedio}),G.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:[e.porcentajeTotal,"%"]})]},a))})]})})})]})]})},Ie="ok",Be="warning",Re="danger",$e=e=>{if(!e||!Array.isArray(e))return 0;const a=new Date,r=new Date(a.getFullYear(),a.getMonth(),1);return e.filter(e=>{var t;const s=new Date(e.fecha);return s>=r&&s<=a&&(null==(t=e.resultado)?void 0:t.toLowerCase().includes("exitoso"))}).length},Fe=({beneficiary:e="Sin nombre",status:a=Re,comuna:r="Sin comuna registrada",llamadasExitosas:t=[],totalLlamadas:s=0,llamadasExitosasDelMes:o=0,ultimaLlamada:i})=>G.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-4",children:[G.jsxs("div",{className:"flex justify-between items-start",children:[G.jsxs("div",{className:"space-y-1",children:[G.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e}),G.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),G.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-semibold "+(a===Ie?"bg-green-100 text-green-800":a===Be?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:a===Ie?"Al día":a===Be?"Pendiente":"Urgente"})]}),G.jsxs("div",{className:"space-y-2",children:[G.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Total llamadas: ",s]}),G.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Llamadas exitosas este mes: ",o]}),i&&G.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Última llamada: ",i]}),t&&t.length>0&&G.jsxs("div",{className:"space-y-1",children:[G.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Últimas llamadas exitosas:"}),t.slice(-3).reverse().map((e,a)=>G.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e},`${e}-${a}`))]})]})]});function ze(){const{callData:a,assignments:r}=e.useContext(Ve),[t,s]=e.useState("all"),[o,i]=e.useState(""),[l,n]=e.useState("all"),d=e.useMemo(()=>(null==a?void 0:a.llamadasPorBeneficiario)?Object.entries(a.llamadasPorBeneficiario).map(([e,a])=>{var r;const t=a.llamadas||[],s=(e=>{if(!e||0===e.length)return Re;const a=new Date,r=[...e].sort((e,a)=>new Date(a.fecha)-new Date(e.fecha)),t=r[0],s=Math.floor((a-new Date(t.fecha))/864e5),o=r.find(e=>{var a;return null==(a=e.resultado)?void 0:a.toLowerCase().includes("exitoso")});if(o&&Math.floor((a-new Date(o.fecha))/864e5)<=15)return Ie;return s>30?Re:Be})(t),o=(null==(r=t[0])?void 0:r.comuna)||"Sin comuna",i=t.filter(e=>{var a;return null==(a=e.resultado)?void 0:a.toLowerCase().includes("exitoso")}),l=t.length>0?new Date(Math.max(...t.map(e=>new Date(e.fecha)))).toLocaleDateString():null;return{beneficiario:e,status:s,comuna:o,llamadasExitosas:i.map(e=>new Date(e.fecha).toLocaleDateString()),totalLlamadas:t.length,llamadasExitosasDelMes:$e(t),ultimaLlamada:l}}):(console.log("No hay datos de beneficiarios"),[]),[null==a?void 0:a.llamadasPorBeneficiario]),c=e.useMemo(()=>d.filter(e=>{const a=e.beneficiario.toLowerCase().includes(o.toLowerCase()),r="all"===l||e.comuna===l,s="all"===t||"uptodate"===t&&e.status===Ie||"urgent"===t&&e.status===Re||"warning"===t&&e.status===Be;return a&&r&&s}),[d,o,l,t]),m=e.useMemo(()=>{const e=new Set(d.map(e=>e.comuna));return Array.from(e).sort()},[d]),u=e.useMemo(()=>({total:d.length,uptodate:d.filter(e=>e.status===Ie).length,urgentes:d.filter(e=>e.status===Re).length,pendientes:d.filter(e=>e.status===Be).length}),[d]),x=({label:e,count:a,className:r})=>G.jsxs("div",{className:`flex flex-col items-center p-4 rounded-lg shadow-md ${r}`,children:[G.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:e}),G.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a})]});return G.jsxs("div",{className:"p-6 space-y-6",children:[G.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(he,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),G.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filtros:"})]}),G.jsx("div",{className:"flex-1",children:G.jsx("select",{value:l,onChange:e=>n(e.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:border-blue-500 focus:ring-blue-500 dark:text-gray-200",children:m.map(e=>G.jsx("option",{value:e,children:"todas"===e?"Todas las comunas":e},e))})}),G.jsx("div",{className:"flex-1",children:G.jsxs("select",{value:t,onChange:e=>s(e.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:border-blue-500 focus:ring-blue-500 dark:text-gray-200",children:[G.jsx("option",{value:"all",children:"Todos los estados"}),G.jsx("option",{value:Ie,children:"Al día"}),G.jsx("option",{value:Be,children:"Atención"}),G.jsx("option",{value:Re,children:"Urgentes"})]})}),G.jsx("div",{className:"flex-1",children:G.jsx("input",{type:"text",placeholder:"Buscar beneficiario...",value:o,onChange:e=>i(e.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:border-blue-500 focus:ring-blue-500 dark:text-gray-200"})})]}),G.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[G.jsx(x,{label:"Todos",count:u.total,className:"bg-gray-100 dark:bg-gray-700"}),G.jsx(x,{label:"Al día",count:u.uptodate,className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100"}),G.jsx(x,{label:"Urgentes",count:u.urgentes,className:"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100"}),G.jsx(x,{label:"Pendientes",count:u.pendientes,className:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-100"})]}),G.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map((e,a)=>G.jsx(Fe,{beneficiary:e.beneficiario,status:e.status,comuna:e.comuna,llamadasExitosas:e.llamadasExitosas,totalLlamadas:e.totalLlamadas,llamadasExitosasDelMes:e.llamadasExitosasDelMes,ultimaLlamada:e.ultimaLlamada},`${e.beneficiario}-${a}`))})]})}const _e=()=>{const[a,r]=e.useState(""),[t,s]=e.useState(""),[o,i]=e.useState(""),{signIn:l}=Ke();return G.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:G.jsxs("div",{className:"max-w-md w-full space-y-8",children:[G.jsx("div",{children:G.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white",children:"Iniciar Sesión"})}),G.jsxs("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault();try{i(""),await l(a,t)}catch(r){i("Error al iniciar sesión: "+r.message)}},children:[G.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[G.jsxs("div",{children:[G.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Correo electrónico"}),G.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 dark:text-white dark:bg-gray-800 dark:border-gray-700 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Correo electrónico",value:a,onChange:e=>r(e.target.value)})]}),G.jsxs("div",{children:[G.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),G.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 dark:text-white dark:bg-gray-800 dark:border-gray-700 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Contraseña",value:t,onChange:e=>s(e.target.value)})]})]}),o&&G.jsx("div",{className:"text-red-500 text-sm text-center",children:o}),G.jsx("div",{children:G.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Iniciar Sesión"})})]})]})})},Ue=x({apiKey:"AIzaSyASPhkFj4RwmmloxSgJzK3JhXD7-qz2yxk",authDomain:"teleasistencia-6c0fd.firebaseapp.com",projectId:"teleasistencia-6c0fd",storageBucket:"teleasistencia-6c0fd.firebasestorage.app",messagingSenderId:"551971576400",appId:"1:551971576400:web:952333e1409c2ecdaf8f55",measurementId:"G-4Z9KWG6JJS"});g(Ue);const He=h(Ue),We=f(Ue),Je=e.createContext(),Ve=e.createContext();function Ze({children:a}){const[r,t]=e.useState(null),[s,o]=e.useState(!0);e.useEffect(()=>p(He,e=>{t(e),o(!1)}),[]);const i={user:r,loading:s,signIn:(e,a)=>b(He,e,a),signOut:()=>y(He)};return G.jsx(Je.Provider,{value:i,children:!s&&a})}function Ke(){return e.useContext(Je)}const qe={totalLlamadas:0,entrantes:0,salientes:0,duracionTotal:0,duracionPromedio:0,beneficiarios:[],llamadasPorBeneficiario:{},ultimasLlamadas:{},llamadasExitosas:{},beneficiariosAlDia:[],beneficiariosPendientes:[],beneficiariosUrgentes:[],comunas:{},teleoperadoras:{},lastUpdate:null};function Ye({children:a}){const[r,s]=e.useState(()=>{try{const e=localStorage.getItem("callData");return e?JSON.parse(e):qe}catch(e){return console.error("Error loading data from localStorage:",e),qe}}),[i,l]=e.useState(()=>{try{const e=localStorage.getItem("assignments");return e?JSON.parse(e):{asignaciones:{}}}catch(e){return console.error("Error loading assignments from localStorage:",e),{asignaciones:{}}}});e.useEffect(()=>{try{const e=localStorage.getItem("callData");e&&s(JSON.parse(e))}catch(e){console.error("Error al cargar datos desde localStorage:",e)}},[]),e.useEffect(()=>{try{r&&Object.keys(r).length>0&&localStorage.setItem("callData",JSON.stringify(r))}catch(e){console.error("Error guardando datos en localStorage:",e)}},[r]),e.useEffect(()=>{try{i&&Object.keys(i).length>0&&localStorage.setItem("assignments",JSON.stringify(i))}catch(e){console.error("Error guardando asignaciones:",e)}},[i]),e.useEffect(()=>{(async()=>{try{const e=t(We,"callData","latest"),a=await getDoc(e);a.exists()?s(a.data()):console.log("No se encontraron datos en Firestore")}catch(e){console.error("Error al cargar datos desde Firestore:",e)}})()},[]),e.useEffect(()=>{(async()=>{try{if(r&&Object.keys(r).length>0){const e=t(We,"callData","latest");await o(e,r)}}catch(e){console.error("Error guardando datos en Firestore:",e)}})()},[r]);const n=e.useCallback(e=>{console.log("Actualizando datos de llamadas:",e),s(a=>({...qe,...a,...e,lastUpdate:(new Date).toISOString(),llamadasPorBeneficiario:{...a.llamadasPorBeneficiario||{},...e.llamadasPorBeneficiario||{}},beneficiarios:Array.isArray(e.beneficiarios)?e.beneficiarios:[],beneficiariosAlDia:Array.isArray(e.beneficiariosAlDia)?e.beneficiariosAlDia:[],beneficiariosPendientes:Array.isArray(e.beneficiariosPendientes)?e.beneficiariosPendientes:[],beneficiariosUrgentes:Array.isArray(e.beneficiariosUrgentes)?e.beneficiariosUrgentes:[]}))},[]),d=e.useCallback(e=>{l(a=>({...a,asignaciones:{...a.asignaciones||{},...e}}))},[]);return G.jsx(Ve.Provider,{value:{callData:r,updateCallData:n,assignments:i,updateAssignments:d,reset:()=>{s(qe),l({asignaciones:{}}),localStorage.removeItem("callData"),localStorage.removeItem("assignments")}},children:a})}const Ge=e.createContext();function Xe({children:a}){const[r,t]=e.useState(!1),s={darkMode:r,toggleTheme:()=>{t(!r),document.documentElement.classList.toggle("dark")}};return G.jsx(Ge.Provider,{value:s,children:a})}function Qe(){const{user:a,loading:r}=Ke(),[t,s]=e.useState("dashboard");return r?G.jsx("div",{children:"Cargando..."}):a?G.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200",children:G.jsxs("div",{className:"flex flex-col h-screen",children:[G.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-md",children:G.jsx("div",{className:"responsive-container",children:G.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-center py-4 space-y-4 lg:space-y-0",children:[G.jsxs("div",{className:"flex items-center w-full lg:w-auto justify-between",children:[G.jsx(Ce,{}),G.jsx("button",{onClick:()=>He.signOut(),className:"lg:hidden px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-150",children:G.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:G.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1H3zm11 4a1 1 0 11-2 0 1 1 0 012 0zm-8 0a1 1 0 11-2 0 1 1 0 012 0zm4 0a1 1 0 11-2 0 1 1 0 012 0z",clipRule:"evenodd"})})})]}),G.jsxs("nav",{className:"flex flex-wrap justify-center gap-2 w-full lg:w-auto overflow-x-auto",children:[G.jsx("button",{onClick:()=>s("dashboard"),className:"px-4 py-2 rounded-lg transition-colors duration-150 whitespace-nowrap "+("dashboard"===t?"bg-blue-500 text-white dark:bg-blue-600":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Dashboard"}),G.jsx("button",{onClick:()=>s("llamadas"),className:"px-4 py-2 rounded-lg transition-colors duration-150 whitespace-nowrap "+("llamadas"===t?"bg-blue-500 text-white dark:bg-blue-600":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Registro de Llamadas"}),G.jsx("button",{onClick:()=>s("asignaciones"),className:"px-4 py-2 rounded-lg transition-colors duration-150 whitespace-nowrap "+("asignaciones"===t?"bg-blue-500 text-white dark:bg-blue-600":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Asignaciones"}),G.jsx("button",{onClick:()=>s("seguimiento"),className:"px-4 py-2 rounded-lg transition-colors duration-150 whitespace-nowrap "+("seguimiento"===t?"bg-blue-500 text-white dark:bg-blue-600":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Historial de Seguimientos"})]}),G.jsx("button",{onClick:()=>He.signOut(),className:"hidden lg:block px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-150",children:"Cerrar Sesión"})]})})}),G.jsx("div",{className:"absolute top-4 right-4 text-sm text-gray-500 dark:text-gray-400",children:"Ver. 1.0.0"}),G.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 transition-colors duration-200",children:G.jsx("div",{className:"responsive-container py-6",children:G.jsxs("div",{className:"w-full overflow-x-hidden",children:["dashboard"===t&&G.jsx(Me,{}),"llamadas"===t&&G.jsx(Le,{}),"asignaciones"===t&&G.jsx(Oe,{}),"seguimiento"===t&&G.jsx(ze,{})]})})}),G.jsx("footer",{className:"bg-gray-100 dark:bg-gray-800 text-center py-4",children:G.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ver. 1.0.0"})})]})}):G.jsx(_e,{})}function ea(){return G.jsx(Xe,{children:G.jsx(Ze,{children:G.jsx(Ye,{children:G.jsx(Qe,{})})})})}X.createRoot(document.getElementById("root")).render(G.jsx(r.StrictMode,{children:G.jsx(Xe,{children:G.jsx(Ze,{children:G.jsx(Ye,{children:G.jsx(ea,{})})})})}));
//# sourceMappingURL=main-7a03e855.js.map
