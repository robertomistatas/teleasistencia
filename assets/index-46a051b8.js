import{r as a,a as Ce,R as Q}from"./vendor-8a332d8f.js";import{g as O,c as L,d as _,s as z,a as me,i as Ee,b as De,e as Le,f as ke,o as Ae,h as Ie,j as $e,k as Oe,u as Re}from"./firebase-5baf7fd7.js";import{r as ue,u as he}from"./xlsx-04f2268f.js";import{R as xe,L as Me,C as pe,X as fe,Y as ne,T as ge,a as be,b as re,B as Fe,c as Te}from"./charts-db6971f8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function o(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(l){if(l.ep)return;l.ep=!0;const d=o(l);fetch(l.href,d)}})();var we={exports:{}},ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be=a,Pe=Symbol.for("react.element"),_e=Symbol.for("react.fragment"),qe=Object.prototype.hasOwnProperty,He=Be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ue={key:!0,ref:!0,__self:!0,__source:!0};function je(s,t,o){var r,l={},d=null,v=null;o!==void 0&&(d=""+o),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(v=t.ref);for(r in t)qe.call(t,r)&&!Ue.hasOwnProperty(r)&&(l[r]=t[r]);if(s&&s.defaultProps)for(r in t=s.defaultProps,t)l[r]===void 0&&(l[r]=t[r]);return{$$typeof:Pe,type:s,key:d,ref:v,props:l,_owner:He.current}}ee.Fragment=_e;ee.jsx=je;ee.jsxs=je;we.exports=ee;var e=we.exports,oe={},ce=Ce;oe.createRoot=ce.createRoot,oe.hydrateRoot=ce.hydrateRoot;function We({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const Ye=a.forwardRef(We),ye=Ye;function Ze({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15"}))}const Ke=a.forwardRef(Ze),Ne=Ke;function ze({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const Ge=a.forwardRef(ze),Je=Ge;function Ve({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Xe=a.forwardRef(Ve),Qe=Xe;function ea({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const aa=a.forwardRef(ea),sa=aa;function ta({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"}))}const ra=a.forwardRef(ta),na=ra;function oa({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const ia=a.forwardRef(oa),la=ia;function ca({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"}))}const da=a.forwardRef(ca),ma=da;function ua({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const ha=a.forwardRef(ua),ve=ha;function xa({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const pa=a.forwardRef(xa),fa=pa;function ga({title:s,titleId:t,...o},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},o),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"}))}const ba=a.forwardRef(ga),wa=ba,ja=({message:s,type:t,onDismiss:o})=>{const r=t==="success"?"bg-green-500":"bg-red-500";return a.useEffect(()=>{if(s){const l=setTimeout(()=>{o()},3e3);return()=>clearTimeout(l)}},[s,o]),s?e.jsx("div",{className:`fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg ${r}`,children:s}):null},ya=()=>{const[s,t]=a.useState(null),[o,r]=a.useState(!1),[l,d]=a.useState({message:"",type:""}),[v,A]=a.useState([]),[m,I]=a.useState(""),[j,D]=a.useState([]),[b,R]=a.useState({start:"",end:new Date().toISOString().split("T")[0]});a.useEffect(()=>{(async()=>{try{const w=await O(L(S,"users"));A(w.docs.map(q=>({id:q.id,...q.data()})));const u=new Date,f=new Date;f.setDate(f.getDate()-30);const T=await O(L(S,"llamados"));D(T.docs.map(q=>({id:q.id,...q.data()})))}catch(w){console.error("Error fetching data:",w),d({message:`Error al cargar datos: ${w.message}`,type:"error"})}})()},[]);const c=n=>{t(n.target.files[0])},C=async()=>{if(!s){d({message:"Por favor, selecciona un archivo",type:"error"});return}r(!0);const n=new FileReader;n.onload=async w=>{try{const u=new Uint8Array(w.target.result),f=ue(u,{type:"array",cellDates:!0,dateNF:"dd/mm/yyyy",raw:!1}),T=f.SheetNames[0],q=f.Sheets[T],i=he.sheet_to_json(q,{raw:!1,dateNF:"dd/mm/yyyy",defval:""});for(const h of i){console.log("Processing row:",h);const p=h.B;if(!p)throw console.error("Fecha vacía en la fila:",h),new Error(`Falta la fecha en la fila con ID: ${h.A||"desconocido"}`);let x;try{if(typeof p=="number"){const P=Math.floor(p-25569)*86400;x=new Date(P*1e3)}else if(typeof p=="string"){const E=p.split("/");if(E.length===3){const P=parseInt(E[0],10),$=parseInt(E[1],10)-1;let Y=parseInt(E[2],10);if(Y<100&&(Y+=Y<50?2e3:1900),isNaN(P)||isNaN($)||isNaN(Y))throw new Error(`Formato de fecha inválido: ${p}`);if(P<1||P>31||$<0||$>11||Y<2e3||Y>2100)throw new Error(`Valores de fecha fuera de rango: ${p}`);x=new Date(Y,$,P)}else x=new Date(p)}else if(p instanceof Date)x=p;else throw new Error(`Formato de fecha no reconocido: ${p}`);if(isNaN(x.getTime()))throw new Error(`Fecha inválida: ${p}`);if(x>new Date)throw new Error(`La fecha ${p} está en el futuro`)}catch(F){throw console.error("Error parsing date:",p,F),new Error(`Error en el formato de fecha: ${p}. La fecha debe estar en formato DD/MM/YYYY`)}const B=F=>{if(!F)return null;try{const E=String(F).trim();if(/^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/.test(E))return E.padStart(5,"0");const $=parseFloat(E);if(!isNaN($)){if($>=0&&$<1){const K=Math.round($*24*60),Z=Math.floor(K/60),J=K%60;return`${Z.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`}else if($>=1&&$<=2359){const K=Math.floor($/100),Z=$%100;if(K>=0&&K<=23&&Z>=0&&Z<=59)return`${K.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`}}const Y=[/^(\d{1,2})[:](\d{2})$/,/^(\d{1,2})[.](\d{2})$/,/^(\d{4})$/];for(const K of Y){const Z=E.match(K);if(Z){let J=parseInt(Z[1],10),te=parseInt(Z[2]||E.slice(-2),10);if(J>=0&&J<=23&&te>=0&&te<=59)return`${J.toString().padStart(2,"0")}:${te.toString().padStart(2,"0")}`}}return console.warn("Formato de hora no válido:",F),null}catch(E){return console.error("Error al procesar la hora:",F,E),null}},V=B(h.G),H=B(h.H);if(!V||!H)throw new Error(`Hora inválida en la fila con ID ${h.A}: Inicio=${h.G}, Fin=${h.H}`);if(!h.A||!x||!h.C||!h.E)throw new Error(`Faltan campos requeridos en la fila: ${JSON.stringify(h)}`);const U=String(h.E||"").toLowerCase().trim();if(U!=="entrante"&&U!=="saliente")throw new Error(`Tipo de llamada inválido: ${h.E}. Debe ser 'entrante' o 'saliente'`);const W=parseInt(h.I);if(isNaN(W)||W<0)throw new Error(`Duración inválida: ${h.I}. Debe ser un número positivo`);const se={idLlamado:String(h.A).trim(),fecha:x,beneficiarioNombre:String(h.C).trim(),comuna:String(h.D||"").trim(),tipo:U,telefono:String(h.F||"").trim(),horaInicio:V,horaFin:H,segundos:W},G=_(L(S,"llamados"));await z(G,se)}const g=await O(L(S,"llamados"));D(g.docs.map(h=>({id:h.id,...h.data()}))),d({message:"Registros de llamadas cargados con éxito",type:"success"})}catch(u){console.error("Error processing file:",u),console.error("Error details:",u),d({message:`Error al procesar archivo: ${u.message}. Las fechas deben estar en formato DD/MM/YYYY y las horas en formato HH:MM.`,type:"error"})}finally{r(!1),t(null),document.getElementById("file-upload")&&(document.getElementById("file-upload").value=null)}},n.readAsArrayBuffer(s)},k=()=>{let n=j;if(b.start){const u=new Date(b.start);n=n.filter(f=>(f.fecha instanceof Date?f.fecha:new Date(f.fecha))>=u)}if(b.end){const u=new Date(b.end);u.setHours(23,59,59),n=n.filter(f=>f.fecha<=u)}return{totalCalls:n.length,incomingCalls:n.filter(u=>u.tipo==="entrante").length,outgoingCalls:n.filter(u=>u.tipo==="saliente").length,totalDuration:n.reduce((u,f)=>u+(f.segundos||0),0),averageDuration:n.length?Math.round(n.reduce((u,f)=>u+(f.segundos||0),0)/n.length):0,uniqueBeneficiaries:new Set(n.map(u=>u.beneficiarioNombre)).size}},M=()=>{let n=j;if(b.start&&(n=n.filter(u=>u.fecha>=new Date(b.start))),b.end){const u=new Date(b.end);u.setHours(23,59,59),n=n.filter(f=>f.fecha<=u)}const w={};return n.forEach(u=>{const f=u.fecha.toLocaleDateString();w[f]||(w[f]={date:f,totalCalls:0,entrantes:0,salientes:0,totalDuration:0,uniqueBeneficiarios:new Set}),w[f].totalCalls++,w[f].totalDuration+=u.segundos||0,u.tipo==="entrante"?w[f].entrantes++:w[f].salientes++,w[f].uniqueBeneficiarios.add(u.beneficiarioNombre)}),Object.values(w).sort((u,f)=>u.date.localeCompare(f.date))},y=k(),N=M();return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx(ja,{message:l.message,type:l.type,onDismiss:()=>d({message:"",type:""})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Cargar Registros de Llamadas"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:["                    ",e.jsxs("p",{className:"text-gray-600 mb-4",children:["Sube un archivo Excel con los registros de llamadas:",e.jsx("br",{}),"Columna A: ID del llamado",e.jsx("br",{}),"Columna B: Fecha del llamado",e.jsx("br",{}),"Columna C: Nombre del Beneficiario",e.jsx("br",{}),"Columna D: Comuna del Beneficiario",e.jsx("br",{}),"Columna E: Tipo (entrante/saliente)",e.jsx("br",{}),"Columna F: Teléfono del beneficiario",e.jsx("br",{}),"Columna G: Hora inicio",e.jsx("br",{}),"Columna H: Hora fin",e.jsx("br",{}),"Columna I: Segundos hablados"]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:e.jsx("input",{type:"file",id:"file-upload",accept:".xlsx,.xls",onChange:c,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),e.jsxs("button",{onClick:C,disabled:o||!s,className:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-blue-600 disabled:bg-gray-400",children:[o?e.jsx(ye,{className:"h-5 w-5 animate-spin"}):e.jsx(Ne,{className:"h-5 w-5"}),o?"Procesando...":"Subir y Procesar"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Filtros"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teleoperadora"}),e.jsxs("select",{value:m,onChange:n=>I(n.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Todas"}),v.map(n=>e.jsx("option",{value:n.id,children:n.nombre},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Inicio"}),e.jsx("input",{type:"date",value:b.start,onChange:n=>R(w=>({...w,start:n.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Fin"}),e.jsx("input",{type:"date",value:b.end,onChange:n=>R(w=>({...w,end:n.target.value})),className:"w-full p-2 border rounded-md"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Estadísticas"}),"                ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Total Llamadas"}),e.jsx("p",{className:"text-3xl font-bold",children:y.totalCalls})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Entrantes"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:y.incomingCalls}),e.jsxs("p",{className:"text-sm text-gray-500",children:[y.totalCalls?Math.round(y.incomingCalls/y.totalCalls*100):0,"% del total"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Salientes"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:y.outgoingCalls}),e.jsxs("p",{className:"text-sm text-gray-500",children:[y.totalCalls?Math.round(y.outgoingCalls/y.totalCalls*100):0,"% del total"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Duración Total"}),e.jsxs("p",{className:"text-3xl font-bold",children:[Math.round(y.totalDuration/60)," min"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Duración Promedio"}),e.jsxs("p",{className:"text-3xl font-bold",children:[y.averageDuration," seg"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Beneficiarios"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:y.uniqueBeneficiaries})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Tendencias"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:["                    ",e.jsx(xe,{width:"100%",height:400,children:e.jsxs(Me,{data:N,children:[e.jsx(pe,{strokeDasharray:"3 3"}),e.jsx(fe,{dataKey:"date"}),e.jsx(ne,{yAxisId:"left"}),e.jsx(ne,{yAxisId:"right",orientation:"right"}),e.jsx(ge,{}),e.jsx(be,{}),e.jsx(re,{yAxisId:"left",type:"monotone",dataKey:"entrantes",name:"Llamadas Entrantes",stroke:"#3b82f6"}),e.jsx(re,{yAxisId:"left",type:"monotone",dataKey:"salientes",name:"Llamadas Salientes",stroke:"#8b5cf6"}),e.jsx(re,{yAxisId:"right",type:"monotone",dataKey:"totalDuration",name:"Duración Total (min)",stroke:"#10b981"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Registro de Llamadas"}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha/Hora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Beneficiario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Comuna"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Teléfono"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Duración"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.filter(n=>{if(b.start&&n.fecha<new Date(b.start))return!1;if(b.end){const w=new Date(b.end);if(w.setHours(23,59,59),n.fecha>w)return!1}return!0}).sort((n,w)=>w.fecha-n.fecha).slice(0,50).map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.idLlamado}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[new Date(n.fecha).toLocaleDateString()," ",n.horaInicio]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.beneficiarioNombre}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.comuna}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${n.tipo==="entrante"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:n.tipo})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.telefono}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.segundos," seg"]})]},n.id))})]})})]})]})},Na=({message:s,type:t,onDismiss:o})=>{const r=t==="success"?"bg-green-500":"bg-red-500";return a.useEffect(()=>{if(s){const l=setTimeout(()=>{o()},3e3);return()=>clearTimeout(l)}},[s,o]),s?e.jsx("div",{className:`fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg ${r}`,children:s}):null},va=()=>{const[s,t]=a.useState(!1),[o,r]=a.useState(null),[l,d]=a.useState({message:"",type:""}),[v,A]=a.useState([]),[m,I]=a.useState([]),[j,D]=a.useState([]),[b,R]=a.useState(""),[c,C]=a.useState(""),[k,M]=a.useState(null),[y,N]=a.useState([]);a.useEffect(()=>{(async()=>{try{const g=await O(L(S,"users"));I(g.docs.map(x=>({id:x.id,...x.data()})));const h=await O(L(S,"beneficiarios"));D(h.docs.map(x=>({id:x.id,...x.data()})));const p=await O(L(S,"assignments"));A(p.docs.map(x=>({id:x.id,...x.data()})))}catch(g){console.error("Error fetching data:",g),d({message:`Error al cargar datos: ${g.message}`,type:"error"})}})()},[]);const n=i=>{r(i.target.files[0])},w=async()=>{try{const g=(await O(L(S,"assignments"))).docs.map(p=>({id:p.id,...p.data()}));A(g);const h=m.map(p=>{const x=g.filter(B=>B.operadoraId===p.id);return{...p,beneficiariosCount:x.length,beneficiarios:x.map(B=>({id:B.beneficiarioId,nombre:B.beneficiarioNombre,assignmentId:B.id}))}});N(h)}catch(i){console.error("Error refreshing data:",i),d({message:`Error al actualizar datos: ${i.message}`,type:"error"})}},u=async()=>{if(!o||!b){d({message:"Por favor, selecciona una operadora y un archivo",type:"error"});return}t(!0);const i=new FileReader;i.onload=async g=>{try{const h=new Uint8Array(g.target.result),p=ue(h,{type:"array"}),x=p.SheetNames[0],B=p.Sheets[x],V=he.sheet_to_json(B,{header:"A"}),H=m.find(U=>U.id===b);console.log("Processing Excel for operadora:",H.nombre);for(const U of V.slice(1)){const W=U.A,se=U.B?String(U.B).split(",").map(E=>E.trim()):[];if(!W)continue;let G=j.find(E=>E.nombre.toLowerCase()===W.toLowerCase());const F=v.find(E=>E.beneficiarioNombre.toLowerCase()===W.toLowerCase());if(F){if(F.operadoraId===b)continue;await z(_(S,"assignments",F.id),{beneficiarioId:F.beneficiarioId,beneficiarioNombre:W,operadoraId:H.id,operadoraNombre:H.nombre,updatedAt:new Date})}else{if(!G){const P=_(L(S,"beneficiarios")),$={nombre:W,telefonos:se};await z(P,$),G={id:P.id,...$}}const E=_(L(S,"assignments"));await z(E,{beneficiarioId:G.id,beneficiarioNombre:G.nombre,operadoraId:H.id,operadoraNombre:H.nombre,createdAt:new Date})}}await w(),d({message:`Asignaciones procesadas con éxito para ${H.nombre}`,type:"success"}),R(""),r(null),document.getElementById("file-upload")&&(document.getElementById("file-upload").value=null)}catch(h){console.error("Error processing file:",h),d({message:`Error al procesar archivo: ${h.message}`,type:"error"})}finally{t(!1)}},i.readAsArrayBuffer(o)},f=async()=>{if(!b||!c){d({message:"Por favor, selecciona una operadora y un beneficiario",type:"error"});return}try{const i=m.find(x=>x.id===b),g=j.find(x=>x.id===c),h=_(L(S,"assignments"));await z(h,{beneficiarioId:g.id,beneficiarioNombre:g.nombre,operadoraId:i.id,operadoraNombre:i.nombre,createdAt:new Date}),d({message:"Asignación creada con éxito",type:"success"});const p=await O(L(S,"assignments"));A(p.docs.map(x=>({id:x.id,...x.data()}))),R(""),C("")}catch(i){console.error("Error creating assignment:",i),d({message:`Error al crear asignación: ${i.message}`,type:"error"})}},T=async i=>{if(window.confirm("¿Estás seguro de que quieres eliminar esta asignación?"))try{await me(_(S,"assignments",i)),A(v.filter(g=>g.id!==i)),d({message:"Asignación eliminada con éxito",type:"success"})}catch(g){console.error("Error deleting assignment:",g),d({message:`Error al eliminar asignación: ${g.message}`,type:"error"})}},q=()=>{const i=m.map(g=>{const h=v.filter(p=>p.operadoraId===g.id);return{...g,beneficiariosCount:h.length,beneficiarios:h.map(p=>({id:p.beneficiarioId,nombre:p.beneficiarioNombre,assignmentId:p.id}))}});N(i)};return a.useEffect(()=>{(async()=>{try{const g=await O(L(S,"users"));I(g.docs.map(x=>({id:x.id,...x.data()})));const h=await O(L(S,"beneficiarios"));D(h.docs.map(x=>({id:x.id,...x.data()})));const p=await O(L(S,"assignments"));A(p.docs.map(x=>({id:x.id,...x.data()})))}catch(g){console.error("Error fetching data:",g),d({message:`Error al cargar datos: ${g.message}`,type:"error"})}})()},[]),a.useEffect(()=>{m.length>0&&v.length>=0&&q()},[v,m]),e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx(Na,{message:l.message,type:l.type,onDismiss:()=>d({message:"",type:""})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Carga de Beneficiarios por Teleoperadora"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar Teleoperadora"}),e.jsxs("select",{value:b,onChange:i=>R(i.target.value),className:"w-full p-2 border rounded-md mb-4",children:[e.jsx("option",{value:"",children:"Seleccionar operadora"}),m.map(i=>e.jsx("option",{value:i.id,children:i.nombre},i.id))]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Sube un archivo Excel con los beneficiarios:",e.jsx("br",{}),"Columna A: Nombre del beneficiario",e.jsx("br",{}),"Columna B: Teléfonos (separados por comas)"]})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:e.jsx("input",{type:"file",id:"file-upload",accept:".xlsx,.xls",onChange:n,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),e.jsxs("button",{onClick:u,disabled:s||!o||!b,className:"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-blue-600 disabled:bg-gray-400",children:[s?e.jsx(ye,{className:"h-5 w-5 animate-spin"}):e.jsx(Ne,{className:"h-5 w-5"}),s?"Procesando...":"Subir y Procesar"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Asignación Manual"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora"}),e.jsxs("select",{value:b,onChange:i=>R(i.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Seleccionar operadora"}),m.map(i=>e.jsx("option",{value:i.id,children:i.nombre},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Beneficiario"}),e.jsxs("select",{value:c,onChange:i=>C(i.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Seleccionar beneficiario"}),j.map(i=>e.jsx("option",{value:i.id,children:i.nombre},i.id))]})]})]}),e.jsx("button",{onClick:f,className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:"Crear Asignación"})]})]}),"            ",e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Asignaciones Actuales"}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operadora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Beneficiarios Asignados"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(i=>e.jsxs(Q.Fragment,{children:[e.jsxs("tr",{className:`${k===i.id?"bg-blue-50":""} hover:bg-gray-50 cursor-pointer`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium",onClick:()=>M(k===i.id?null:i.id),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:`h-5 w-5 mr-2 transform transition-transform ${k===i.id?"rotate-180":""}`}),i.nombre]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[i.beneficiariosCount," beneficiarios"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap"})]}),k===i.id&&i.beneficiarios.map(g=>e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-2 pl-12 whitespace-nowrap text-sm",children:g.nombre}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm"}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>T(g.assignmentId),className:"text-red-600 hover:text-red-900",title:"Eliminar asignación",children:e.jsx(ve,{className:"h-4 w-4"})})})]},g.id))]},i.id))})]})})]})]})},Sa={apiKey:"AIzaSyASPhkFj4RwmmloxSgJzK3JhXD7-qz2yxk",authDomain:"teleasistencia-6c0fd.firebaseapp.com",projectId:"teleasistencia-6c0fd",storageBucket:"teleasistencia-6c0fd.firebasestorage.app",messagingSenderId:"551971576400",appId:"1:551971576400:web:952333e1409c2ecdaf8f55",measurementId:"G-4Z9KWG6JJS"},ie=Ee(Sa);De(ie);const X=Le(ie),S=ke(ie),Se=a.createContext(),Ca=({children:s})=>{const[t,o]=a.useState(null),[r,l]=a.useState(!0);a.useEffect(()=>{const I=Ae(X,j=>{o(j),l(!1)});return()=>I()},[]);const m={user:t,login:(I,j)=>Ie(X,I,j),register:(I,j)=>$e(X,I,j),logout:()=>Oe(X),loading:r};return e.jsx(Se.Provider,{value:m,children:!r&&s})},ae=()=>a.useContext(Se),le=()=>e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})}),Ea=({isOpen:s,onClose:t,title:o,children:r})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:o}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-800",children:"×"})]}),e.jsx("div",{className:"p-4",children:r})]})}):null,Da=({message:s,type:t,onDismiss:o})=>{const r=t==="success"?"bg-green-500":"bg-red-500";return s?(a.useEffect(()=>{const l=setTimeout(()=>{o()},3e3);return()=>clearTimeout(l)},[s,o]),e.jsx("div",{className:`fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg ${r}`,children:s})):null},La=()=>{const[s,t]=a.useState(""),[o,r]=a.useState(""),[l,d]=a.useState(""),[v,A]=a.useState(!1),{login:m}=ae(),I=async j=>{j.preventDefault(),d(""),A(!0);try{await m(s,o)}catch(D){d("Error al iniciar sesión. Verifique sus credenciales."),console.error(D)}A(!1)};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-md w-full max-w-sm",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-gray-800 mb-6",children:"Mistatas Call Center"}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:s,onChange:j=>t(j.target.value),className:"w-full px-3 py-2 border rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Contraseña"}),e.jsx("input",{id:"password",type:"password",value:o,onChange:j=>r(j.target.value),className:"w-full px-3 py-2 border rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),l&&e.jsx("p",{className:"text-red-500 text-xs italic mb-4",children:l}),e.jsx("button",{type:"submit",disabled:v,className:"w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline disabled:bg-blue-300",children:v?"Ingresando...":"Iniciar Sesión"})]})]})})},ka=({setView:s})=>{const{logout:t}=ae(),o=[{name:"Dashboard",icon:Je,view:"dashboard"},{name:"Teleoperadoras",icon:wa,view:"operadoras"},{name:"Beneficiarios",icon:ma,view:"beneficiarios"},{name:"Asignaciones",icon:na,view:"assignments"},{name:"Registro de Llamadas",icon:sa,view:"cargar"}];return e.jsxs("div",{className:"w-64 bg-gray-800 text-white flex flex-col min-h-screen",children:[e.jsx("div",{className:"p-5 border-b border-gray-700",children:e.jsx(Logo,{})}),e.jsx("nav",{className:"flex-grow",children:o.map(r=>e.jsxs("button",{onClick:()=>s(r.view),className:"w-full text-left flex items-center px-4 py-3 hover:bg-gray-700",children:[e.jsx(r.icon,{className:"h-6 w-6 mr-3"}),r.name]},r.name))}),e.jsx("div",{className:"p-5 border-t border-gray-700",children:e.jsx("button",{onClick:t,className:"w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded",children:"Cerrar Sesión"})})]})},de=()=>{const[s,t]=a.useState([]),[o,r]=a.useState([]),[l,d]=a.useState([]),[v,A]=a.useState(!0),[m,I]=a.useState({startDate:"",endDate:"",teleoperadoraId:"all",comuna:"all",tipoLlamada:"all"});a.useEffect(()=>{(async()=>{A(!0);const C=await O(L(S,"llamados"));t(C.docs.map(y=>({id:y.id,...y.data()})));const k=await O(L(S,"users"));r(k.docs.map(y=>({id:y.id,...y.data()})));const M=await O(L(S,"beneficiarios"));d(M.docs.map(y=>({id:y.id,...y.data()}))),A(!1)})()},[]);const j=c=>{I({...m,[c.target.name]:c.target.value})},D=Q.useMemo(()=>s.filter(c=>{if(!c.fecha||typeof c.fecha.toDate!="function")return!1;const C=c.fecha.toDate(),k=m.startDate?new Date(m.startDate):null,M=m.endDate?new Date(m.endDate):null;if(k&&C<k||M&&C>M||m.teleoperadoraId!=="all"&&c.teleoperadoraId!==m.teleoperadoraId||m.tipoLlamada!=="all"&&c.tipo!==m.tipoLlamada)return!1;if(m.comuna!=="all"){const y=l.find(N=>N.id===c.beneficiarioId);if(!y||y.comuna!==m.comuna)return!1}return!0}),[s,m,l]),b=Q.useMemo(()=>{const c=o.map(C=>({id:C.id,nombre:C.nombre,totalLlamados:0,totalSegundos:0}));return D.forEach(C=>{const k=c.find(M=>M.id===C.teleoperadoraId);k&&(k.totalLlamados+=1,k.totalSegundos+=C.segundos)}),c},[D,o]),R=[...new Set(l.map(c=>c.comuna))];return v?e.jsx(le,{}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Dashboard de Análisis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6 p-4 bg-white rounded-lg shadow",children:[e.jsx("input",{type:"date",name:"startDate",value:m.startDate,onChange:j,className:"p-2 border rounded"}),e.jsx("input",{type:"date",name:"endDate",value:m.endDate,onChange:j,className:"p-2 border rounded"}),e.jsxs("select",{name:"teleoperadoraId",value:m.teleoperadoraId,onChange:j,className:"p-2 border rounded",children:[e.jsx("option",{value:"all",children:"Todas las operadoras"}),o.map(c=>e.jsx("option",{value:c.id,children:c.nombre},c.id))]}),e.jsxs("select",{name:"comuna",value:m.comuna,onChange:j,className:"p-2 border rounded",children:[e.jsx("option",{value:"all",children:"Todas las comunas"}),R.map(c=>e.jsx("option",{value:c,children:c},c))]}),e.jsxs("select",{name:"tipoLlamada",value:m.tipoLlamada,onChange:j,className:"p-2 border rounded",children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),e.jsx("option",{value:"entrante",children:"Entrante"}),e.jsx("option",{value:"saliente",children:"Saliente"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Total Llamados"}),e.jsx("p",{className:"text-3xl font-bold",children:D.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Tiempo Total (min)"}),e.jsx("p",{className:"text-3xl font-bold",children:Math.round(D.reduce((c,C)=>c+C.segundos,0)/60)})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Cobertura"}),e.jsx("p",{className:"text-3xl font-bold",children:l.length>0?`${Math.round([...new Set(D.map(c=>c.beneficiarioId))].length/l.length*100)}%`:"0%"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Llamados por Teleoperadora"}),e.jsx(xe,{width:"100%",height:300,children:e.jsxs(Fe,{data:b,children:[e.jsx(pe,{strokeDasharray:"3 3"}),e.jsx(fe,{dataKey:"nombre"}),e.jsx(ne,{}),e.jsx(ge,{}),e.jsx(be,{}),e.jsx(Te,{dataKey:"totalLlamados",fill:"#8884d8",name:"Total de Llamados"})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Rendimiento por Teleoperadora"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Operadora"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Llamados"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Minutos"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Promedio (s)"})]})}),e.jsx("tbody",{children:b.map(c=>e.jsxs("tr",{className:"bg-white border-b",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap",children:c.nombre}),e.jsx("td",{className:"px-6 py-4",children:c.totalLlamados}),e.jsx("td",{className:"px-6 py-4",children:Math.round(c.totalSegundos/60)}),e.jsx("td",{className:"px-6 py-4",children:c.totalLlamados>0?Math.round(c.totalSegundos/c.totalLlamados):0})]},c.id))})]})})]})]})]})},Aa=()=>{const[s,t]=a.useState([]),[o,r]=a.useState(!0),[l,d]=a.useState(!1),[v,A]=a.useState(null),[m,I]=a.useState({nombre:"",email:"",password:""}),[j,D]=a.useState({message:"",type:""}),{register:b}=ae(),R=async()=>{r(!0);const N=L(S,"users"),w=(await O(N)).docs.map(u=>({id:u.id,...u.data()}));t(w),r(!1)};a.useEffect(()=>{(async()=>{const n=L(S,"users");if((await O(n)).empty){const u=[{nombre:"Roberto Mistatas",email:"roberto@mistatas.com"},{nombre:"Ana Maria Asencio",email:"ana.asencio@example.com"},{nombre:"Catalina Aguilera",email:"catalina.aguilera@example.com"},{nombre:"Daniela Carmona",email:"daniela.carmona@example.com"},{nombre:"Antonella Valdebenito",email:"antonella.valdebenito@example.com"}];for(const f of u)try{const T=await b(f.email,"password123");await z(_(S,"users",T.user.uid),{nombre:f.nombre,email:f.email})}catch(T){console.error("Error creating initial user:",T)}}R()})()},[b]);const c=(N=null)=>{A(N),I(N?{nombre:N.nombre,email:N.email}:{nombre:"",email:"",password:""}),d(!0)},C=()=>{d(!1),A(null)},k=N=>{I({...m,[N.target.name]:N.target.value})},M=async N=>{N.preventDefault();try{if(v)await Re(_(S,"users",v.id),{nombre:m.nombre}),D({message:"Operadora actualizada con éxito",type:"success"});else{const n=await b(m.email,m.password);await z(_(S,"users",n.user.uid),{nombre:m.nombre,email:m.email}),D({message:"Operadora creada con éxito",type:"success"})}R(),C()}catch(n){console.error("Error saving operator:",n),D({message:`Error: ${n.message}`,type:"error"})}},y=async N=>{if(window.confirm("¿Estás seguro de que quieres eliminar esta operadora? Esta acción no se puede deshacer."))try{await me(_(S,"users",N)),D({message:"Operadora eliminada (solo de la base de datos)",type:"success"}),R()}catch(n){console.error("Error deleting operator:",n),D({message:`Error al eliminar: ${n.message}`,type:"error"})}};return o?e.jsx(le,{}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx(Da,{message:j.message,type:j.type,onDismiss:()=>D({message:"",type:""})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Gestión de Teleoperadoras"}),e.jsxs("button",{onClick:()=>c(),className:"bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-600",children:[e.jsx(fa,{className:"h-5 w-5"})," Nueva Operadora"]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map(N=>e.jsxs("tr",{className:"bg-white border-b",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap",children:N.nombre}),e.jsx("td",{className:"px-6 py-4",children:N.email}),e.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[e.jsx("button",{onClick:()=>c(N),className:"text-blue-600 hover:text-blue-900",children:e.jsx(la,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>y(N.id),className:"text-red-600 hover:text-red-900",children:e.jsx(ve,{className:"h-5 w-5"})})]})]},N.id))})]})})}),e.jsx(Ea,{isOpen:l,onClose:C,title:v?"Editar Operadora":"Nueva Operadora",children:e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Nombre"}),e.jsx("input",{type:"text",name:"nombre",value:m.nombre,onChange:k,className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:m.email,onChange:k,className:"w-full p-2 border rounded",required:!0,disabled:!!v})]}),!v&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Contraseña"}),e.jsx("input",{type:"password",name:"password",value:m.password,onChange:k,className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-gray-300 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Guardar"})]})]})})]})},Ia=()=>e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Gestión de Beneficiarios"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[e.jsx("p",{className:"text-gray-600",children:"La funcionalidad CRUD para beneficiarios seguiría el mismo patrón que la gestión de Teleoperadoras."}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Implica crear un formulario en un modal para añadir/editar nombre, comuna y teléfonos, y conectarlo a la colección 'beneficiarios' en Firestore."})]})]}),$a=()=>{const[s,t]=a.useState("dashboard"),o=()=>{switch(s){case"dashboard":return e.jsx(de,{});case"operadoras":return e.jsx(Aa,{});case"beneficiarios":return e.jsx(Ia,{});case"assignments":return e.jsx(va,{});case"cargar":return e.jsx(ya,{});default:return e.jsx(de,{})}};return e.jsxs("div",{className:"flex",children:[e.jsx(ka,{setView:t}),e.jsx("main",{className:"flex-grow",children:o()})]})};function Oa(){return e.jsx(Ca,{children:e.jsx(Ra,{})})}const Ra=()=>{const{user:s,loading:t}=ae();return t?e.jsx("div",{className:"h-screen w-screen flex items-center justify-center",children:e.jsx(le,{})}):s?e.jsx($a,{}):e.jsx(La,{})};oe.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsx(Oa,{})}));
